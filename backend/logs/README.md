# 日志管理说明

## 日志配置

当前日志系统使用 `zap` + `lumberjack` 实现，支持自动轮转和压缩。

### 默认配置

- **日志文件**: `./logs/go-app.log`
- **单个文件大小**: 50MB
- **保留天数**: 7天
- **最大备份数**: 5个文件
- **压缩**: 启用
- **输出到控制台**: 关闭（生产环境）

### 日志轮转规则

1. 当日志文件达到 50MB 时，会自动创建新文件
2. 旧文件会被重命名为 `go-app.log.1`, `go-app.log.2` 等
3. 超过 5 个备份文件时，最旧的文件会被删除
4. 超过 7 天的日志文件会被自动删除
5. 备份文件会被压缩以节省空间

### 日志级别

- `DEBUG`: 调试信息
- `INFO`: 一般信息
- `WARN`: 警告信息
- `ERROR`: 错误信息
- `PANIC`: 严重错误
- `FATAL`: 致命错误

### 日志格式

日志采用 JSON 格式，包含以下字段：

```json
{
  "level": "info",
  "time_local": "2024-01-01 12:00:00.000",
  "msg": "日志消息",
  "caller_line": "file.go:123",
  "cur_hostname": "hostname",
  "x_request_id": "uuid",
  "req_client_ip": "127.0.0.1",
  "request_method": "GET",
  "request_uri": "/api/v1/test"
}
```

## 日志清理

### 手动清理

使用提供的清理脚本：

```bash
# 清理超过7天的日志文件
./scripts/clean-logs.sh 7

# 清理超过3天的日志文件，单个文件限制100MB
./scripts/clean-logs.sh 3 100
```

### 自动清理

日志系统会自动管理文件大小和保留时间，无需手动干预。

## 监控建议

1. **磁盘空间**: 定期检查 `./logs` 目录的磁盘使用情况
2. **日志级别**: 生产环境建议使用 `INFO` 级别
3. **日志轮转**: 确保日志轮转正常工作
4. **错误日志**: 关注 `ERROR` 级别的日志

## 故障排除

### 日志文件过大

1. 检查日志级别是否设置过低（DEBUG 会产生大量日志）
2. 检查是否有重复的日志输出
3. 考虑调整 `MaxSize` 参数

### 磁盘空间不足

1. 运行清理脚本删除旧日志
2. 检查是否有其他大文件占用空间
3. 考虑增加磁盘空间

### 日志轮转不工作

1. 检查文件权限
2. 检查磁盘空间
3. 重启应用以重新初始化日志系统 